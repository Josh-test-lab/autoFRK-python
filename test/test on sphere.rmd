---
title: "AutoFRK"
output: html_notebook
---

```{r}
library(dplyr)
library(autoFRK)
library(reticulate)
np <- import("numpy")
```

```{r}
data_path <- "../../Weather2K/weather2k.npy"
data <- np$load(data_path) %>% py_to_r()

data <- aperm(data, c(2, 1, 3))
dim(data)
```

```{r}
lat_lon_alt <- t(data[1:3, , 1])
data <- data[-(1:3), , ]
lat_lon_alt %>% head() %>% print()
```

```{r}
real <- data[1, , ]

prob_nan <- 0.3
missing <- real
mask <- runif(length(real)) < prob_nan
missing[mask] <- NaN
```

```{r}
params <- list(
  data = missing,
  loc = lat_lon_alt[, 1:2],
  method = "fast"
)
```

```{r}
start_time = Sys.time()
model_r <- autoFRK(
  data = params$data,
  loc = params$loc,
  method = params$method
)

pred_r <- predict(model_r)
end_time = Sys.time()
```

```{r}
mse = mean((pred_r$pred.value - real) ** 2)
mspe = mean((pred_r$pred.value - real) ** 2 / real)
paste0('MSE: ', mse) %>% print()
paste0('MSPE: ', mspe) %>% print()
paste0('Time spend: ', end_time - start_time) %>% print()
```
[1] "MSE: 226492.074387879"
[1] "MSPE: 236.610276899608"
[1] "Time spend: 4.15673331816991"

